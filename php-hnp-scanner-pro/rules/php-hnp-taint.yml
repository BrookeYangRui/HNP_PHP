rules:
  - id: php-hnp-host-to-redirect
    languages: [php]
    message: Host flows to redirect sink (potential HNP)
    severity: ERROR
    mode: taint
    pattern-sources:
      - pattern: $_SERVER['HTTP_HOST']
      - pattern: $_SERVER['SERVER_NAME']
      - pattern: $_SERVER['HTTP_X_FORWARDED_HOST']
      - pattern: $REQ->getHost(...)
      - pattern: $request->getHost(...)
    pattern-sinks:
      - pattern: redirect(...)
      - pattern: wp_redirect(...)
      - pattern: Url::to(...)
      - pattern: new RedirectResponse(...)
    pattern-sanitizers:
      - pattern: URL::forceRootUrl(...)
      - pattern: $this->setTrustedHosts(...)
      - pattern: setTrustedHosts(...)

  - id: php-hnp-host-to-url
    languages: [php]
    message: Host flows to URL generation sink (potential HNP)
    severity: WARNING
    mode: taint
    pattern-sources:
      - pattern: $_SERVER['HTTP_HOST']
      - pattern: $_SERVER['SERVER_NAME']
      - pattern: $_SERVER['HTTP_X_FORWARDED_HOST']
      - pattern: $REQ->getHost(...)
    pattern-sinks:
      - pattern: url(...)
      - pattern: route(...)
      - pattern: asset(...)
      - pattern: home_url(...)
      - pattern: site_url(...)
      - pattern: base_url(...)
    pattern-sanitizers:
      - pattern: URL::forceRootUrl(...)
      - pattern: $config['base_url']
      - pattern: define('WP_HOME', ...)
      - pattern: define('WP_SITEURL', ...)
