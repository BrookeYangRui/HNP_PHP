rules:
- id: discover-cookie-domain-like
  languages: [php]
  severity: INFO
  message: "Candidate sink: sets cookie domain from tainted host"
  mode: taint
  pattern-sources:
    - pattern: $_SERVER["HTTP_HOST"]
    - pattern: $REQ->getHost()
  pattern-sinks:
    # setcookie 第 7/数组 options 里 domain 键
    - pattern: setcookie(..., $OPTS)
      metavariable-pattern:
        - metavariable: $OPTS
          pattern: /.*('|"|)domain('|"|)\s*=>\s*.*/
    # 面向对象 Cookie：任意 set*Domain / withDomain
    - pattern: $COOKIE->$M($D)
      metavariable-pattern:
        - metavariable: $M
          pattern: /(set|with)[A-Za-z]*Domain/i
  pattern-either:
    - pattern: setcookie($NAME, $VALUE, ..., $OPTS)
      metavariable-pattern:
        - metavariable: $OPTS
          pattern: /.*('|"|)domain('|"|)\s*=>\s*.*/
    - pattern: $COOKIE->$M($D)
      metavariable-pattern:
        - metavariable: $M
          pattern: /(set|with)[A-Za-z]*Domain/i
